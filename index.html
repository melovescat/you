<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bias‑Filtered Face Viewer</title>
  <style>
/* (same styling as before) */
body {
  margin: 0;
  padding: 0;
  font-family: Arial, Helvetica, sans-serif;
  line-height: 1.5;
  background-color: #f9fafb;
  color: #333;
}
header {
  background-color: #2d2d2d;
  color: #ffffff;
  padding: 2rem 1rem;
  text-align: center;
}
header h1 { margin: 0; font-size: 2rem; }
header p { margin-top: 0.5rem; font-size: 1rem; max-width: 600px; margin-left: auto; margin-right: auto; }
main { max-width: 960px; margin: 0 auto; padding: 2rem 1rem; }
.upload { text-align: center; margin-bottom: 2rem; }
.upload input[type="file"] { padding: 0.5rem; font-size: 1rem; }
.results { display: flex; justify-content: space-around; flex-wrap: wrap; margin-bottom: 2rem; }
.hidden { display: none; }
.image-container { text-align: center; flex: 1 1 45%; margin: 1rem; }
.image-container h2 { margin-bottom: 0.5rem; font-size: 1.2rem; }
.image-container img { max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
.info { background-color: #fff; padding: 1rem 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.info h3 { margin-top: 0; font-size: 1.3rem; }
.info ul { list-style: disc inside; padding-left: 0; }
.info li { margin-bottom: 0.5rem; }
footer { background-color: #2d2d2d; color: #fff; text-align: center; padding: 1rem; font-size: 0.9rem; }
  </style>
</head>
<body>
  <header>
    <h1>See the bias‑filtered version of your face</h1>
    <p>Upload a photo to explore how much of beauty perception is tied to skin tone.</p>
  </header>
  <main>
    <section class="upload">
      <input type="file" id="fileInput" accept="image/*">
    </section>
    <section id="results" class="results hidden">
      <div class="image-container">
        <h2>Original</h2>
        <img id="originalImage" alt="Original image">
      </div>
      <div class="image-container">
        <h2>Bias‑Filtered</h2>
        <img id="processedImage" alt="Bias filtered image">
      </div>
    </section>
    <section class="info">
      <h3>What we change and what we keep</h3>
      <ul>
        <li>We keep your facial features: bone structure, nose, lips, eyes, jawline and expression.</li>
        <li>We normalise skin tone to a single dark brown colour to reduce colour‑related bias.</li>
        <li>This is an educational tool to help you understand bias, not a beauty filter.</li>
      </ul>
    </section>
  </main>
  <footer>
    <p>&copy; 2025 Unbiased Beauty. All rights reserved.</p>
  </footer>
  <script>
/*
 * Client‑side image processing. When the user uploads an image, it shows the
 * original and a processed version. The processed version replaces every
 * detected skin pixel with a fixed dark brown tone (#4f2421) so that the skin
 * appears uniformly dark regardless of the original skin tone. Non‑skin pixels
 * remain unchanged.
 */
document.addEventListener('DOMContentLoaded', () => {
  const fileInput = document.getElementById('fileInput');
  const originalImage = document.getElementById('originalImage');
  const processedImage = document.getElementById('processedImage');
  const resultsSection = document.getElementById('results');

  fileInput.addEventListener('change', event => {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = e => {
      const dataURL = e.target.result;
      originalImage.src = dataURL;
      processImage(dataURL).then(processedURL => {
        processedImage.src = processedURL;
        resultsSection.classList.remove('hidden');
      });
    };
    reader.readAsDataURL(file);
  });

  async function processImage(dataURL) {
    return new Promise(resolve => {
      const img = new Image();
      img.onload = () => {
        const canvas = document.createElement('canvas');
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;

        // Simple YCbCr-based skin detector
        function isSkinPixel(r, g, b) {
          const Y = 0.299 * r + 0.587 * g + 0.114 * b;
          const Cb = 128 - 0.168736 * r - 0.331264 * g + 0.5 * b;
          const Cr = 128 + 0.5 * r - 0.418688 * g - 0.081312 * b;
          return (Cr >= 133 && Cr <= 173) && (Cb >= 77 && Cb <= 127);
        }

        // Replace detected skin pixels with the target dark brown colour
        for (let i = 0; i < data.length; i += 4) {
          const r255 = data[i];
          const g255 = data[i + 1];
          const b255 = data[i + 2];
          if (isSkinPixel(r255, g255, b255)) {
            data[i]     = 0x4f; // R = 79
            data[i + 1] = 0x24; // G = 36
            data[i + 2] = 0x21; // B = 33
          }
        }

        ctx.putImageData(imageData, 0, 0);
        resolve(canvas.toDataURL('image/png'));
      };
      img.src = dataURL;
    });
  }
});
  </script>
</body>
</html>
